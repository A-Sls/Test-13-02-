import tkinter as tk
from tkinter import scrolledtext
import random

class PoesieInteractiveComplet:
    def __init__(self, root):
        self.root = root
        self.root.title("LittÃ©rature NumÃ©rique - Mahmoud Darwich")
        self.root.geometry("1200x900")
        self.root.configure(bg="#0f0f1e")
        
        # Le passage complet
        self.passage = """Ø¹Ù„ÙÙ‰ Ù‡ÙØ°ÙÙ‡Ù Ø§Ù„Ø£ÙØ±Ù’Ø¶ Ù…ÙØ§ ÙŠÙØ³Ù’ØªÙØ­ÙÙ‚ÙÙ‘ Ø§Ù„Ø­ÙÙŠØ§Ø©Ù’: ØªÙØ±ÙØ¯ÙÙ‘Ø¯Ù Ø¥Ø¨Ø±ÙŠÙ„Ù, Ø±ÙØ§Ø¦ÙØ­ÙØ©Ù Ø§Ù„Ø®ÙØ¨Ù’Ø²Ù ÙÙÙŠ Ø§Ù„ÙØ¬Ù’Ø±ÙØŒ Ø¢Ø±Ø§Ø¡Ù Ø§Ù…Ù’Ø±Ø£ÙØ©Ù ÙÙÙŠ Ø§Ù„Ø±ÙÙ‘Ø¬Ø§Ù„ÙØŒ ÙƒÙØªÙØ§Ø¨ÙØ§ØªÙ Ø£ÙØ³Ù’Ø®ÙÙŠÙ’Ù„ÙÙŠÙˆØ³ØŒ Ø£ÙˆÙÙ‘Ù„Ù Ø§Ù„Ø­ÙØ¨ÙÙ‘ØŒ Ø¹Ø´Ø¨ÙŒ Ø¹ÙÙ„ÙÙ‰ Ø­Ø¬Ø±ÙØŒ Ø£ÙÙ…ÙÙ‘Ù‡Ø§ØªÙŒ ØªÙÙ‚ÙÙÙ’Ù†Ù Ø¹ÙÙ„ÙÙ‰ Ø®ÙÙŠÙ’Ø·Ù Ù†Ø§ÙŠÙ, ÙˆØ®ÙˆÙÙ Ø§Ù„ØºÙØ²ÙØ§Ø©Ù Ù…ÙÙ†Ù Ø§Ù„Ø°ÙÙ‘ÙƒÙ’Ø±ÙŠØ§ØªÙ’."""
        
        # Dictionnaire complet avec tous les symboles
        self.symboles = {
            "Ø§Ù„Ø£ÙØ±Ù’Ø¶": {
                "couleur": "#2c3e50",
                "emoji": "ğŸ–¤",
                "explication": "Ø§Ù„Ø£ÙØ±Ù’Ø¶ (la terre) : Symbole du pays palestinien, territoire sacrÃ© et mÃ©moire collective. Chez Darwich, c'est l'ancrage existentiel face Ã  l'exil."
            },
            "Ø§Ù„Ø­ÙÙŠØ§Ø©Ù’": {
                "couleur": "#27ae60",
                "emoji": "ğŸŸ¢",
                "explication": "Ø§Ù„Ø­ÙÙŠØ§Ø©Ù’ (la vie) : Ce qui mÃ©rite d'Ãªtre vÃ©cu. Acte de rÃ©sistance poÃ©tique contre l'oubli et la mort politique."
            },
            "ØªÙØ±ÙØ¯ÙÙ‘Ø¯Ù Ø¥Ø¨Ø±ÙŠÙ„Ù": {
                "couleur": "#f39c12",
                "emoji": "ğŸŒ¸",
                "explication": "ØªÙØ±ÙØ¯ÙÙ‘Ø¯Ù Ø¥Ø¨Ø±ÙŠÙ„Ù (le tremblement d'avril) : Avril symbolise le printemps, la renaissance, mais aussi l'incertitude. Image de la nature oscillante."
            },
            "Ø±ÙØ§Ø¦ÙØ­ÙØ©Ù Ø§Ù„Ø®ÙØ¨Ù’Ø²Ù": {
                "couleur": "#e8b76b",
                "emoji": "ğŸ",
                "explication": "Ø±ÙØ§Ø¦ÙØ­ÙØ©Ù Ø§Ù„Ø®ÙØ¨Ù’Ø²Ù ÙÙÙŠ Ø§Ù„ÙØ¬Ù’Ø±Ù (odeur du pain Ã  l'aube) : SensualitÃ© du quotidien, acte de nourrir et transmettre. Le pain comme lien entre gÃ©nÃ©rations."
            },
            "Ø§Ù„ÙØ¬Ù’Ø±Ù": {
                "couleur": "#e74c3c",
                "emoji": "ğŸŒ…",
                "explication": "Ø§Ù„ÙØ¬Ù’Ø±Ù (l'aube) : Moment de passage, espoir qui renaÃ®t chaque jour. LiminalitÃ© entre la nuit (oppression) et la lumiÃ¨re (libertÃ©)."
            },
            "Ø¢Ø±Ø§Ø¡Ù Ø§Ù…Ù’Ø±Ø£ÙØ©Ù": {
                "couleur": "#c0392b",
                "emoji": "ğŸ‘©",
                "explication": "Ø¢Ø±Ø§Ø¡Ù Ø§Ù…Ù’Ø±Ø£ÙØ©Ù ÙÙÙŠ Ø§Ù„Ø±ÙÙ‘Ø¬Ø§Ù„Ù (opinions d'une femme) : Voix fÃ©minine qui juge, critique, pense. Autonomie intellectuelle et Ã©mancipation."
            },
            "ÙƒÙØªÙØ§Ø¨ÙØ§ØªÙ Ø£ÙØ³Ù’Ø®ÙÙŠÙ’Ù„ÙÙŠÙˆØ³": {
                "couleur": "#9b59b6",
                "emoji": "ğŸ“–",
                "explication": "ÙƒÙØªÙØ§Ø¨ÙØ§ØªÙ Ø£ÙØ³Ù’Ø®ÙÙŠÙ’Ù„ÙÙŠÙˆØ³ (Ã©crits d'Eschyle) : RÃ©fÃ©rence Ã  la tragÃ©die grecque. Darwich dialogue avec les grands humanistes universels."
            },
            "Ø£ÙˆÙÙ‘Ù„Ù Ø§Ù„Ø­ÙØ¨ÙÙ‘": {
                "couleur": "#e91e63",
                "emoji": "ğŸ’•",
                "explication": "Ø£ÙˆÙÙ‘Ù„Ù Ø§Ù„Ø­ÙØ¨ÙÙ‘ (le premier amour) : Innocence, Ã©motion primaire. Contrepoint tendre aux violences historiques. L'amour comme affirmation de vie."
            },
            "Ø¹Ø´Ø¨ÙŒ Ø¹ÙÙ„ÙÙ‰ Ø­Ø¬Ø±Ù": {
                "couleur": "#16a085",
                "emoji": "ğŸŒ¿",
                "explication": "Ø¹Ø´Ø¨ÙŒ Ø¹ÙÙ„ÙÙ‰ Ø­Ø¬Ø±Ù (herbe sur la pierre) : MÃ©taphore de tÃ©nacitÃ©. La vie fragile qui pousse sur le dur, l'impossible. Symbole de persistance."
            },
            "Ø£ÙÙ…ÙÙ‘Ù‡Ø§ØªÙŒ": {
                "couleur": "#d35400",
                "emoji": "ğŸ‘µ",
                "explication": "Ø£ÙÙ…ÙÙ‘Ù‡Ø§ØªÙŒ ØªÙÙ‚ÙÙÙ’Ù†Ù Ø¹ÙÙ„ÙÙ‰ Ø®ÙÙŠÙ’Ø·Ù Ù†Ø§ÙŠÙ (mÃ¨res debout sur un fil de flÃ»te) : Image surrÃ©aliste. FragilitÃ© extrÃªme mais dignitÃ© inÃ©branlable."
            },
            "Ù†Ø§ÙŠÙ": {
                "couleur": "#3498db",
                "emoji": "ğŸªˆ",
                "explication": "Ù†Ø§ÙŠÙ (flÃ»te) : Instrument de la poÃ©sie arabe, voix douce. Ã‰quilibre impossible entre musique et soliditÃ©. BeautÃ© fragile."
            },
            "Ø®ÙˆÙÙ Ø§Ù„ØºÙØ²ÙØ§Ø©Ù": {
                "couleur": "#2c3e50",
                "emoji": "ğŸ˜¨",
                "explication": "Ø®ÙˆÙÙ Ø§Ù„ØºÙØ²ÙØ§Ø©Ù (la peur des envahisseurs) : Retournement de perspective. Ce ne sont pas les colonisÃ©s qui ont peur, mais les colonisateurs."
            },
            "Ø§Ù„Ø°ÙÙ‘ÙƒÙ’Ø±ÙŠØ§ØªÙ’": {
                "couleur": "#34495e",
                "emoji": "ğŸ“œ",
                "explication": "Ø§Ù„Ø°ÙÙ‘ÙƒÙ’Ø±ÙŠØ§ØªÙ’ (les souvenirs) : La mÃ©moire comme arme politique suprÃªme. L'histoire et l'identitÃ© que les occupants ne peuvent pas dÃ©truire."
            }
        }
        
        self.couleur_initiale = "#0f0f1e"
        self.setup_ui()
    
    def setup_ui(self):
        # Header
        header = tk.Frame(self.root, bg="#0f0f1e")
        header.pack(pady=15)
        
        tk.Label(header, text="Ù…ÙØ­Ù’Ù…ÙÙˆØ¯Ù’ Ø¯ÙØ±Ù’ÙˆÙÙŠØ´Ù’", 
                font=("Traditional Arabic", 28, "bold"), 
                fg="#ecf0f1", bg="#0f0f1e").pack()
        
        tk.Label(header, text="Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø±Ø¶ Ù…Ø§ ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø­ÙŠØ§Ø©", 
                font=("Traditional Arabic", 18), 
                fg="#bdc3c7", bg="#0f0f1e").pack()
        
        # Main content - deux colonnes
        main_frame = tk.Frame(self.root, bg="#0f0f1e")
        main_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
        
        # Colonne gauche : le texte
        left_frame = tk.Frame(main_frame, bg="#0f0f1e")
        left_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(0,10))
        
        tk.Label(left_frame, text="ğŸ“– Le Passage", 
                font=("Traditional Arabic", 14, "bold"), 
                fg="#ecf0f1", bg="#0f0f1e").pack(anchor="w")
        
        self.texte_poeme = scrolledtext.ScrolledText(left_frame, 
                                                    wrap=tk.WORD, 
                                                    font=("Traditional Arabic", 18),
                                                    height=12,
                                                    bg="#16213e", fg="#ecf0f1",
                                                    insertbackground="#ecf0f1",
                                                    relief=tk.FLAT,
                                                    padx=15, pady=15)
        self.texte_poeme.pack(fill=tk.BOTH, expand=True, pady=(5,0))
        self.texte_poeme.insert("1.0", self.passage)
        self.texte_poeme.config(state=tk.DISABLED)
        self.texte_poeme.bind("<Button-1>", self.on_mot_clique)
        
        # Colonne droite : explications
        right_frame = tk.Frame(main_frame, bg="#0f0f1e", width=350)
        right_frame.pack(side=tk.RIGHT, fill=tk.BOTH, expand=False, padx=(10,0))
        right_frame.pack_propagate(False)
        
        tk.Label(right_frame, text="ğŸ¨ Symboles", 
                font=("Traditional Arabic", 14, "bold"), 
                fg="#ecf0f1", bg="#0f0f1e").pack(anchor="w")
        
        # Zone de commentaire
        self.commentaire_frame = tk.Frame(right_frame, bg="#16213e", relief=tk.FLAT)
        self.commentaire_frame.pack(fill=tk.BOTH, expand=True, pady=(5,0))
        
        self.emoji_label = tk.Label(self.commentaire_frame, text="Cliquez sur un mot",
                                   font=("Arial", 32), fg="#ecf0f1", bg="#16213e")
        self.emoji_label.pack(pady=(10,5))
        
        self.mot_label = tk.Label(self.commentaire_frame, text="",
                                 font=("Traditional Arabic", 14, "bold"), 
                                 fg="#3498db", bg="#16213e", wraplength=300)
        self.mot_label.pack(padx=10)
        
        self.explication_label = tk.Label(self.commentaire_frame, 
                                         text="",
                                         font=("Arial", 10), 
                                         fg="#bdc3c7", bg="#16213e", 
                                         wraplength=300, justify=tk.LEFT)
        self.explication_label.pack(padx=10, pady=10)
        
        # Boutons
        button_frame = tk.Frame(self.root, bg="#0f0f1e")
        button_frame.pack(pady=15)
        
        btn_aleatoire = tk.Button(button_frame, text="ğŸ² Symbole AlÃ©atoire", 
                                 command=self.symbole_aleatoire,
                                 font=("Arial", 11, "bold"),
                                 bg="#3498db", fg="white", 
                                 padx=15, pady=8, relief=tk.FLAT, 
                                 cursor="hand2")
        btn_aleatoire.pack(side=tk.LEFT, padx=10)
        
        btn_reinitialiser = tk.Button(button_frame, text="ğŸ”„ RÃ©initialiser", 
                                     command=self.reinitialiser,
                                     font=("Arial", 11, "bold"),
                                     bg="#e74c3c", fg="white", 
                                     padx=15, pady=8, relief=tk.FLAT,
                                     cursor="hand2")
        btn_reinitialiser.pack(side=tk.LEFT, padx=10)
        
        btn_tous = tk.Button(button_frame, text="ğŸ“š Voir Tous les Symboles", 
                            command=self.afficher_tous,
                            font=("Arial", 11, "bold"),
                            bg="#9b59b6", fg="white", 
                            padx=15, pady=8, relief=tk.FLAT,
                            cursor="hand2")
        btn_tous.pack(side=tk.LEFT, padx=10)
        
        # Message initial
        self.afficher_explication("", "", "", "Cliquez sur un mot pour dÃ©couvrir son sens")
    
    def afficher_explication(self, mot, couleur, emoji, explication):
        self.mot_label.config(text=mot)
        self.emoji_label.config(text=emoji)
        self.explication_label.config(text=explication)
        self.commentaire_frame.config(bg=couleur)
        self.emoji_label.config(bg=couleur)
        self.mot_label.config(bg=couleur)
        self.explication_label.config(bg=couleur)
        self.root.configure(bg=couleur)
    
    def on_mot_clique(self, event):
        index = self.texte_poeme.index(f"@{event.x},{event.y}")
        texte_complet = self.texte_poeme.get("1.0", tk.END).strip()
        
        # Cherche le mot le plus proche du clic
        mot_trouve = None
        distance_min = float('inf')
        
        for symbole in self.symboles.keys():
            if symbole in texte_complet:
                pos = texte_complet.find(symbole)
                if pos != -1:
                    # Estimation de la distance
                    distance = abs(pos - len(texte_complet[:int(index.split('.')[0])*50]))
                    if distance < distance_min:
                        distance_min = distance
                        mot_trouve = symbole
        
        if mot_trouve and distance_min < 100:
            info = self.symboles[mot_trouve]
            self.afficher_explication(
                mot_trouve,
                info["couleur"],
                info["emoji"],
                info["explication"]
            )
        else:
            self.afficher_explication(
                "?",
                "#e74c3c",
                "âŒ",
                "Cliquez sur un mot-clÃ© du poÃ¨me"
            )
    
    def symbole_aleatoire(self):
        symbole = random.choice(list(self.symboles.keys()))
        info = self.symboles[symbole]
        self.afficher_explication(
            symbole,
            info["couleur"],
            info["emoji"],
            info["explication"]
        )
    
    def reinitialiser(self):
        self.afficher_explication(
            "", "", "", 
            "Cliquez sur un mot pour dÃ©couvrir son sens"
        )
        self.root.configure(bg=self.couleur_initiale)
        self.commentaire_frame.config(bg="#16213e")
        self.emoji_label.config(bg="#16213e")
        self.mot_label.config(bg="#16213e")
        self.explication_label.config(bg="#16213e")
    
    def afficher_tous(self):
        # FenÃªtre popup avec tous les symboles
        popup = tk.Toplevel(self.root)
        popup.title("Tous les Symboles")
        popup.geometry("600x700")
        popup.configure(bg="#0f0f1e")
        
        title = tk.Label(popup, text="ğŸ¨ Tous les Symboles", 
                        font=("Traditional Arabic", 16, "bold"),
                        fg="#ecf0f1", bg="#0f0f1e")
        title.pack(pady=10)
        
        scrollbar = scrolledtext.ScrolledText(popup, 
                                             wrap=tk.WORD,
                                             font=("Arial", 10),
                                             bg="#16213e", fg="#ecf0f1",
                                             relief=tk.FLAT, padx=15, pady=15)
        scrollbar.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
        
        for i, (symbole, info) in enumerate(self.symboles.items(), 1):
            texte = f"{i}. {info['emoji']} {symbole}\n"
            texte += f"   Couleur: {info['couleur']}\n"
            texte += f"   {info['explication']}\n\n"
            scrollbar.insert(tk.END, texte)
        
        scrollbar.config(state=tk.DISABLED)

if __name__ == "__main__":
    root = tk.Tk()
    app = PoesieInteractiveComplet(root)
    root.mainloop()